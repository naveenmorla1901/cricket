<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricket Stats Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .tabs { border: 1px solid #ccc; }
        .tab-header { padding: 10px; background: #f0f0f0; cursor: pointer; display: inline-block; }
        .tab-header.active { background: #007bff; color: white; }
        .tab-content { padding: 20px; border-top: 1px solid #ccc; }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f0f0f0; }
        .summary { background: #e9ecef; padding: 10px; margin-bottom: 10px; }
        .loading { text-align: center; padding: 20px; color: #666; }
        .error { background: #f8d7da; color: #721c24; padding: 10px; }
    </style>
</head>
<body>
    <h1>üèè Cricket Stats Debug</h1>
    
    <div class="filters">
        <label>Team: <select id="teamFilter"><option value="">All Teams</option></select></label>
        <label>Match Type: <select id="matchTypeFilter"><option value="">All Types</option></select></label>
        <label>Year: <select id="yearFilter"><option value="2025">2025</option></select></label>
    </div>

    <div class="tabs">
        <div class="tab-headers">
            <div class="tab-header active" data-tab="batting">Batting</div>
            <div class="tab-header" data-tab="bowling">Bowling</div>
            <div class="tab-header" data-tab="fielding">Fielding</div>
            <div class="tab-header" data-tab="ranking">Rankings</div>
        </div>

        <div class="tab-content">
            <div id="batting" class="tab-pane active">
                <div id="batting-summary" class="summary">Loading...</div>
                <table id="batting-table">
                    <thead></thead>
                    <tbody></tbody>
                </table>
            </div>

            <div id="bowling" class="tab-pane">
                <div id="bowling-summary" class="summary">Loading...</div>
                <table id="bowling-table">
                    <thead></thead>
                    <tbody></tbody>
                </table>
            </div>

            <div id="fielding" class="tab-pane">
                <div id="fielding-summary" class="summary">Loading...</div>
                <table id="fielding-table">
                    <thead></thead>
                    <tbody></tbody>
                </table>
            </div>

            <div id="ranking" class="tab-pane">
                <div id="ranking-summary" class="summary">Loading...</div>
                <table id="ranking-table">
                    <thead></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        class SimpleCricketStats {
            constructor() {
                console.log('üöÄ Starting SimpleCricketStats...');
                this.data = {};
                this.currentTab = 'batting';
                this.init();
            }

            async init() {
                console.log('üìã Checking elements...');
                this.checkElements();
                
                console.log('üîó Setting up events...');
                this.setupEvents();
                
                console.log('üìä Loading data...');
                await this.loadData();
            }

            checkElements() {
                const required = ['batting-summary', 'batting-table', 'bowling-summary', 'bowling-table', 
                                'fielding-summary', 'fielding-table', 'ranking-summary', 'ranking-table'];
                
                required.forEach(id => {
                    const element = document.getElementById(id);
                    console.log(`${element ? '‚úÖ' : '‚ùå'} ${id}:`, element ? 'Found' : 'Missing');
                });
            }

            setupEvents() {
                document.querySelectorAll('.tab-header').forEach(header => {
                    header.addEventListener('click', (e) => {
                        this.switchTab(e.target.dataset.tab);
                    });
                });
            }

            async loadData() {
                try {
                    const year = 2025;
                    console.log(`üì• Loading data for ${year}...`);

                    // Load all data files
                    const files = ['batting', 'bowling', 'fielding', 'ranking'];
                    const promises = files.map(async (type) => {
                        try {
                            const response = await fetch(`./data/${type}_${year}.json`);
                            if (response.ok) {
                                const data = await response.json();
                                console.log(`‚úÖ ${type}: ${data.data.length} records`);
                                return { type, data: data.data };
                            } else {
                                console.warn(`‚ö†Ô∏è ${type}: Failed to load`);
                                return { type, data: [] };
                            }
                        } catch (error) {
                            console.error(`‚ùå ${type}:`, error);
                            return { type, data: [] };
                        }
                    });

                    const results = await Promise.all(promises);
                    
                    // Store data
                    results.forEach(({ type, data }) => {
                        this.data[type] = data;
                    });

                    console.log('üéØ Data loaded:', Object.keys(this.data).map(k => `${k}: ${this.data[k].length}`));
                    
                    // Render current tab
                    this.renderTab(this.currentTab);

                } catch (error) {
                    console.error('üí• Load error:', error);
                    this.showError('Failed to load data');
                }
            }

            switchTab(tabName) {
                console.log(`üîÑ Switching to ${tabName}`);
                
                // Update headers
                document.querySelectorAll('.tab-header').forEach(h => h.classList.remove('active'));
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                
                // Update panes
                document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
                document.getElementById(tabName).classList.add('active');
                
                this.currentTab = tabName;
                this.renderTab(tabName);
            }

            renderTab(tabName) {
                console.log(`üñºÔ∏è Rendering ${tabName}...`);
                
                const data = this.data[tabName] || [];
                console.log(`üìä Data for ${tabName}:`, data.length, 'records');
                
                this.renderSummary(tabName, data);
                this.renderTable(tabName, data);
            }

            renderSummary(tabName, data) {
                const summaryEl = document.getElementById(`${tabName}-summary`);
                if (!summaryEl) {
                    console.error(`‚ùå Summary element not found: ${tabName}-summary`);
                    return;
                }

                const summary = `üìä ${tabName.toUpperCase()}: ${data.length} records`;
                summaryEl.innerHTML = summary;
                console.log(`‚úÖ Summary rendered for ${tabName}`);
            }

            renderTable(tabName, data) {
                const table = document.getElementById(`${tabName}-table`);
                if (!table) {
                    console.error(`‚ùå Table not found: ${tabName}-table`);
                    return;
                }

                const thead = table.querySelector('thead');
                const tbody = table.querySelector('tbody');
                
                if (!thead || !tbody) {
                    console.error(`‚ùå Table parts missing for ${tabName}`);
                    return;
                }

                if (data.length === 0) {
                    thead.innerHTML = '';
                    tbody.innerHTML = '<tr><td>No data available</td></tr>';
                    return;
                }

                // Get visible columns (hide sensitive data)
                const hidden = ['Club_ID', 'Club_Name', 'Group', 'Player_ID'];
                const columns = Object.keys(data[0]).filter(col => !hidden.includes(col));
                
                // Render header
                thead.innerHTML = `<tr>${columns.map(col => `<th>${col}</th>`).join('')}</tr>`;
                
                // Render rows (limit to first 50 for performance)
                const rows = data.slice(0, 50).map(row => 
                    `<tr>${columns.map(col => `<td>${row[col] || ''}</td>`).join('')}</tr>`
                ).join('');
                
                tbody.innerHTML = rows;
                console.log(`‚úÖ Table rendered for ${tabName}: ${Math.min(data.length, 50)} rows`);
            }

            showError(message) {
                document.querySelectorAll('.tab-pane.active .summary').forEach(el => {
                    el.innerHTML = `<div class="error">${message}</div>`;
                });
            }
        }

        // Start when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üåü Page loaded, starting app...');
            new SimpleCricketStats();
        });
    </script>
</body>
</html>